<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        *{
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            width: 100%;
        }
        #nav{
   border-right: 1px solid rgba(154, 147, 147, 0.192);
}
#centre{
    border-right: 1px solid rgba(154, 147, 147, 0.192);
 }
 .scrollbar-hide {
    scrollbar-width: none; /* For Firefox */
    -ms-overflow-style: none; /* For Internet Explorer and Edge */
}

.scrollbar-hide::-webkit-scrollbar {
    display: none; /* For Chrome, Safari, and Opera */
}

    </style>
     <link
     href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
     rel="stylesheet"
 />
</head>
<body>
   
    <div id="main" class="bg-black h-full w-full flex">

        <div id="nav" class="w-[20%] h-full ">
            
            <div class="logo h-[40px] w-fit mx-7 my-10 "> <!-- Center the container -->
                <img class="h-full w-full object-contain" src="https://www.pngkey.com/png/full/28-287308_instagram-logo-text-white.png" alt="Instagram Logo">
            </div>

           
            <div id="search" class=" py-10 px-4 absolute h-full top-[0%] w-[450px] bg-zinc-500 transition ease-in hidden">
                
              <i id="closeSearchBox" class="ri-close-large-line text-2xl text-white font-bold absolute top-[3%] right-[3%] cursor-pointer "></i>
            
                 <div class=" h-[120px] w-full border-b border-1 border-gray-300 mt-10">        
                    <h1 class="text-white text-4xl font-semibold ">Search</h1>
                    <h3 class="w-full mt-4 bg-zinc-700 px-2 py-2 flex items-center rounded-lg"><input id="searchInput" value="" class="h-full w-full p-2 bg-transparent outline-none border-none text-1xl text-white" type="text" placeholder="Search" > <i class="ri-close-large-line text-1xl text-white font-bold cursor-pointer"></i> </h3>
                 </div>


                <div class="listOfUsers mt-4">

                <div class="SearchedProfile flex justify-between  px-1 py-1 items-center" >

                     <a href="/profile/<%=user.username%>" class="cursor-pointer">
                        <div class="flex gap-4 items-center">
                      
                            <div class="profilePhoto h-[30px] w-[30px] rounded-full overflow-hidden"> <!-- Added overflow-hidden to hide excess parts -->
                              <img class="h-full w-full object-cover" src="https://images.unsplash.com/photo-1482849737880-498de71dda8d?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFuZHNvbWUlMjBib3l8ZW58MHx8MHx8fDA%3D" alt="Profile Photo">
                          </div>
                          
                          
                            <div class="flex flex-col gap ">
                                <h3 class="text-[16px] text-white"><%=user.username%></h3>
                                <h4 class="text-[12px] text-white opacity-60 mt-[-5px]"><%=user.name%>  </h4>
                            </div>
    
    
                        </div>
                     </a>   
                    
  
                    <button class="bg-blue-500 px-4 py-2 text-[14px] text-white rounded font-semibold ">Follow</button>
  
      
                  </div>
  
                  

                </div>

            </div>

            <div id="createPost" class="min-h-full w-full absolute top-[0]  bg-zinc-700 opacity-90 hidden">
                <i id="closeCreatePost" class="ri-close-large-line text-4xl  text-white cursor-pointer absolute right-5 top-5  "></i>

                <div class="postCreate  max-h-[650px] pt-7 w-[550px] bg-zinc-900 absolute top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] rounded-lg shadow-lg overflow-y-auto">
                    <h3 class="text-white text-4xl text-center">Create Post</h3>
                    
                    <form action="/postCreate/<%= user._id%>" class="flex flex-col gap-4 items-center" method="post" enctype="multipart/form-data">
                        <i class="ri-image-line text-[80px] text-white"></i>
            
                        <div class="custom-file-upload bg-blue-500 px-4 py-2 text-white rounded cursor-pointer">
                            <label for="fileInput" id="fileLabel" class="text-2xl cursor-pointer">Select Photo</label>
                            <input type="file" id="fileInput" name="image" accept="image/* " style="display: none;">
                        </div>
            
                        <!-- Image Preview -->
                        <div>
                            <img id="imagePreview" class="image-preview h-[400px] object-cover rounded-lg" src="" alt="Image Preview" style="display: none;">
                        </div>
            
                        <!-- Caption Textarea -->
                        <textarea id="captionInput" name="caption" class="w-[80%] h-[100px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-transparent text-white placeholder-gray-500 hidden " placeholder="Write your Comment"></textarea>
            
                        <!-- Post Button -->
                        <input id="PostUploadButton" type="submit" value="Post" class="bg-blue-500 px-10 py-2 text-2xl text-white cursor-pointer hidden mb-2" >
                    </form>
                </div>
            

            </div>

            <div class="menu flex flex-col gap-4">

              <a href="/dashboard">
                <div class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                    <i class="ri-home-5-line text-3xl text-white "></i>
                    <h3 class="text-[18px] text-white">Home</h3>
                </div>
              </a>

                <div id="searchFreinds" class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                    <i class="ri-search-2-line text-3xl text-white "></i>
                    <h3 class="text-[18px] text-white">Search</h3>
                </div>

                <div class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                    <i class="ri-messenger-line text-3xl text-white "></i>
                    <h3 class="text-[18px] text-white">Messages</h3>
                </div>

                <div class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                    <i class="ri-heart-3-line text-3xl text-white "></i>
                    <h3 class="text-[18px] text-white">Notifications</h3>
                </div>

                <div id="clickOnPost" class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                    <i class="ri-add-circle-line text-3xl text-white "></i>
                    <h3 class="text-[18px] text-white">Create Post</h3>
                </div>
                 
                <div class="navElements flex gap-4 items-center mx-7 cursor-pointer hover:bg-neutral-600 transition ease-in rounded px-1 py-2">
                   <a href="/profile/<%=logedInUser.username%>" class="flex gap-4 items-center">
                    <div class="profilePhoto h-[40px] w-[40px] rounded-full overflow-hidden"> <!-- Added overflow-hidden to hide excess parts -->
                        <img class="h-full w-full object-cover" src="https://images.unsplash.com/photo-1482849737880-498de71dda8d?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFuZHNvbWUlMjBib3l8ZW58MHx8MHx8fDA%3D" alt="Profile Photo">
                    </div>
                    <h3 class="text-[18px] text-white">Profile</h3>
                   </a>
                </div>

               

            </div>

        </div>


        <div id="ProfileDetails" class="w-[80%] h-full pl-[150px] pr-[60px] py-10 flex flex-col gap-4 overflow-y-auto  scrollbar-hide">

            <div class="box max-h-[400px] w-[82%] p-2 flex  flex-col justify-between">
    
                <div class="content flex">
                    <div id="dp" class="h-40 w-40 rounded-full bg-gray-800">
                        <img src="" alt="">
                    </div>
                    
                    <div class="personalDetails w-[80%] pl-[100px] flex flex-col gap-4">
                        <div class="naming flex gap-4">
                            <h1 class="text-2xl text-white"><%= user.username %></h1>
                            
                            <!-- Conditional rendering for follow/friend/archive/edit buttons -->
                            <% if (user._id.toString() !== logedInUser._id.toString()) { %>
                        
                                <!-- Check if the logged-in user is already a friend -->
                                <% if (user.friends && user.friends.includes(logedInUser._id)) { %>
                                    <button class="text-1xl px-2 py-1 bg-zinc-200 rounded">Friend</button>
                                <% } else { %>
                                    <!-- If not a friend, show follow button -->
                                    <a href="/send-request/<%=user._id%>">
                                        <button class="text-1xl px-2 py-1 bg-zinc-200 rounded">Follow</button>
                                    </a>
                                <% } %>
                        
                                <a href="">
                                    <button class="text-1xl px-2 py-1 bg-zinc-200 rounded">Archive</button>
                                </a>
                            <% } else { %>
                                <!-- If it's the logged-in user's own profile, show edit/view profile buttons -->
                                <a href="">
                                    <button class="text-1xl px-2 py-1 bg-zinc-200 rounded">Edit Profile</button>
                                </a>
                                <a href="">
                                    <button class="text-1xl px-2 py-1 bg-zinc-200 rounded">View Profile</button>
                                </a>
                            <% } %>
                        </div>
                        
            
                        <div class="freindsDetails flex gap-7 items-center">
                            <h5 class="text-1xl text-white font-semi-bold"><%= user.posts.length%> Post</h5>
                            <h5 class="text-1xl text-white font-semi-bold"><%= user.friends.length%> freinds</h5>
                            <a href="/viewFreinds/<%=user._id%>"><h5 class="text-[10px] text-white font-semi-bold bg-blue-500 px-1 py-1"> View Friends</h5></a>
                        </div>
            
                        <div class="bio ">
                            <h2 class="text-1xl text-white w-[40%] leading-6">
                                <%= user.name%> <br> 
                                <%= user.bio %>      
                            </h2>
                        </div>
                    </div>
                </div>
            
            </div>
            
        
            <div class="line mt-2 w-full h-[.5px] bg-zinc-100 opacity-50">
            </div>
        
            <div class="posts h-[500px] ">
                <h1 class="text-4xl opacity-60 text-white">Posts</h1>


                <div class="allPosts flex gap-4 flex-wrap">
                  
                     <% user.posts.forEach(function(post){ %>
                      <div class="box h-[300px] w-[300px] bg-blue-500 mt-10">
                        <img class="h-full w-full object-cover" src="../images/posts/<%= post.img%>" alt="">
                      </div>
               <% }) %>
                </div>
                   
                    
                </div>
            </div>
        </div>
        

     </div>

</body>

<script>

    function openSearchBox(){
     
        document.querySelector('#searchFreinds').addEventListener("click",function(){
            document.querySelector("#search").classList.remove("hidden")
        })

        document.querySelector('#closeSearchBox').addEventListener('click',function(){
            document.querySelector("#search").classList.add("hidden")

        })
    }

    openSearchBox()
    
    function searchFriend(){
            
        document.querySelector("#searchInput").addEventListener("input", async function(e){

            let query = document.querySelector("#searchInput").value;

            if (!query.trim()) {document.querySelector(".listOfUsers").innerHTML=''; }

            try{
                const response = await fetch(`/allUsers/search?query=${query}`);
                const users = await response.json();
                console.log(users);
                
                const listOfUsers = document.querySelector(".listOfUsers");
                listOfUsers.innerHTML='';

                if(users.length==0){
                    listOfUsers.innerHTML='<p class="text-white text-1xl">No users found</p>';
                }else{
                    users.forEach(function(user){
                        listOfUsers.innerHTML += `
                            
                <div class="SearchedProfile flex justify-between  px-1 py-1 items-center" >

                     <a href="/profile/${user.username}" class="cursor-pointer">
                        <div class="flex gap-4 items-center">
                      
                            <div class="profilePhoto h-[30px] w-[30px] rounded-full overflow-hidden"> <!-- Added overflow-hidden to hide excess parts -->
                              <img class="h-full w-full object-cover" src="https://images.unsplash.com/photo-1482849737880-498de71dda8d?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFuZHNvbWUlMjBib3l8ZW58MHx8MHx8fDA%3D" alt="Profile Photo">
                          </div>
                          
                          
                            <div class="flex flex-col gap ">
                                <h3 class="text-[16px] text-white">${user.username}</h3>
                                <h4 class="text-[12px] text-white opacity-60 mt-[-5px]">${user.name}</h4>
                            </div>
    
    
                        </div>
                     </a>   
                    
  
                    <button class="bg-blue-500 px-4 py-2 text-[14px] text-white rounded font-semibold ">Follow</button>
  
      
                  </div>
                    
                        `
                    })
                }
                

            }catch(error){
                console.error('Error fetching users:', error);
            }
                


        
            

         })
    }

    searchFriend()

    function postPopOpen(){
        document.querySelector("#clickOnPost").addEventListener("click",function(){ 
            console.log("sjdfkl");
            
            document.querySelector("#createPost").classList.remove("hidden");
        })

        document.querySelector("#closeCreatePost").addEventListener("click",function(){ 
            document.querySelector("#createPost").classList.add("hidden");
        })
        

    }
    postPopOpen()

    function imagesShow(){
        const fileInput = document.getElementById('fileInput');
    const imagePreview = document.getElementById('imagePreview');

    // Add event listener to handle file input changes  
    fileInput.addEventListener('change', function(event) {
      const file = event.target.files[0]; // Get the selected file

      if (file) {
        const reader = new FileReader();

        // Once the file is loaded, display it
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block'; // Show the image preview
          document.querySelector("#captionInput").classList.remove('hidden');
          document.querySelector("#PostUploadButton").classList.remove("hidden")
        }

        // Read the image file as a Data URL
        reader.readAsDataURL(file);
      }
    });
    }

    imagesShow()

    




</script>
</html>